(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function c(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(e){if(e.ep)return;e.ep=!0;const n=c(e);fetch(e.href,n)}})();const s=document.getElementById("screen"),m=document.getElementById("mainText"),d=document.getElementById("subText"),I=document.getElementById("startBtn"),B=document.getElementById("resetBtn"),L=document.getElementById("bestBtn"),E=document.getElementById("lastTime"),T=document.getElementById("bestTime"),x=document.getElementById("avgTime"),f=document.getElementById("historyList");let o="idle",p=null,b=0,i=JSON.parse(localStorage.getItem("reaction_rounds")||"[]");function g(){localStorage.setItem("reaction_rounds",JSON.stringify(i))}function l(){if(i.length===0){E.textContent="— ms",T.textContent="— ms",x.textContent="— ms",f.innerHTML="";return}const t=i.map(e=>e.time).filter(e=>typeof e=="number"),a=t[t.length-1],c=Math.min(...t),r=Math.round(t.reduce((e,n)=>e+n,0)/t.length);E.textContent=a+" ms",T.textContent=c+" ms",x.textContent=r+" ms",f.innerHTML="",i.slice().reverse().forEach(e=>{const n=document.createElement("div");n.className="histItem",n.innerHTML=`<div>${new Date(e.t).toLocaleTimeString()}</div><div>${e.time?e.time+" ms":'<em style="color:var(--muted)">Descalificado</em>'}</div>`,f.appendChild(n)})}function y(t){navigator.vibrate&&navigator.vibrate(t)}function h(){o="idle",s.className="screen ready",m.textContent="Toca para empezar",d.textContent="Presiona INICIAR o toca el área"}function C(){if(o==="waiting")return;o="waiting",s.className="screen wait",m.textContent="Preparado...",d.textContent="Espera el cambio y toca lo más rápido que puedas";const t=1e3+Math.floor(Math.random()*1500);clearTimeout(p),p=setTimeout(()=>{o="go",s.className="screen go",m.textContent="¡Toca!",d.textContent="¡Ahora!",b=performance.now(),y(30)},t)}function N(){clearTimeout(p),o="tooSoon",s.className="screen tooSoon",m.textContent="Muy pronto",d.textContent="Se descalifica esta ronda",y([50,30,50]),i.push({t:Date.now(),time:null}),g(),l(),setTimeout(()=>{h()},900)}function v(){if(o==="idle"){C();return}if(o==="waiting"){N();return}if(o==="go"){const t=Math.round(performance.now()-b);i.push({t:Date.now(),time:t}),g(),l(),m.textContent=t+" ms",d.textContent="¡Buen trabajo! Toca para otra ronda",y(40),o="idle",s.className="screen ready";return}o==="tooSoon"&&h()}s.addEventListener("click",t=>{v()});s.addEventListener("touchstart",t=>{v()});I.addEventListener("click",()=>C());B.addEventListener("click",()=>{confirm("Borrar historial?")&&(i=[],g(),l())});L.addEventListener("click",()=>{const t=i.map(r=>r.time).filter(r=>typeof r=="number");if(t.length===0){alert("No hay tiempos válidos todavía.");return}const c=`Mi mejor tiempo de reacción: ${Math.min(...t)} ms. ¿Puedes superarlo?`;navigator.share?navigator.share({title:"Prueba de Reacción",text:c}).catch(()=>{}):prompt("Copia y comparte tu mejor tiempo:",c)});l();h();document.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),v())});
